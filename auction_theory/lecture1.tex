\chapter{Аукционы бывают разные}

%Что почитать: 

%Базовый текст: IAT, chapter 3. В IAT поначалу автор использует обозначение $ v_{i} $ для ценностей, а потом меняет %обозначение на $ X_{i} $. Мы сразу будем использовать $ X_{i} $.


\section{Три аукциона и три модели}

\begin{itemize}

\item \indef{Английский аукцион}\index{Английский аукцион}. Именно этот аукцион описан в <<12 стульях>> Ильфа и Петрова. Игроки по очереди называют ставки. Каждая последующая ставка должна быть больше, чем предыдущая. Товар достается тому, кто назвал наибольшую цену. Победитель платит за товар столько, сколько он сам поставил\footnote{Про оплату комиссионого сбора в 12 стульях мы, конечно, помним.} . По этому принципу устроен самый крупный современный он-лайн аукцион товаров в Интернете, Ebay, \url{http://www.ebay.com/}.

\item \indef{Голландский аукцион цветов}\index{Голландский аукцион}. Большинство цветов продающихся в России были куплены на аукционе цветов в Голландии. Этот традиционный аукцион отличается от английского. Потенциальные покупатели цветов сидят в общем зале. Перед ними на стене --- большие часы с одной стрелкой. Стрелка показывает текущую цену товара. Изначально цена высока и никто не хочет покупать. С движением стрелки цена опускается. Наступит момент, когда одного из покупателей цена наконец устроит. Он получает товар и платит соответствующую цену.

\item \indef{Аукцион интернет-рекламы}\index{Интернет-реклама}. Когда пользователь набирает в поисковике (в Яндексе, Гугле или любом другом) какое-нибудь слово, к примеру <<ГУ-ВШЭ>>, поисковик выдает найденные страницы и рекламные ссылки. Естественно, рекламодатели платят за то, что поисковик показывает их рекламные ссылки. Более того, рекламные ссылки продаются на аукционе! Представим себе, что поисковик продает одно рекламное место. Желающие рекламодатели независимо друг от друга направляют свои заявки: <<я готов платить за него 5 копеек за клик>>, <<я готов платить 10 копеек за клик>>, <<я готов платить 7 копеек за клик>>. Побеждает, естественно, тот, кто готов платить больше других. Но платит он не ту сумму, которую заявил в своей заявке! Победитель платит вторую по величине ставку! В нашем примере с тремя заявками рекламное место достается тому, кто был готов платить 10 копеек за клик, но платить он будет 7 копеек за клик. В реальности все чуть сложнее. Например, рекламных мест может быть несколько, тогда тот, кому досталось второе по притягательности место платит ставку того, кому досталось третье. Гугл продает свои рекламные ссылки на \url{adwords.google.com}.

\end{itemize}

Этим трем реальным примерам мы сопоставим три простых модели.


Общее между тремя моделями: 

На аукционе продается единица неделимого товара, скажем одна морковка. За право получить морковку борятся $ n $ покупателей.

% Для $ i $-го покупателя морковка имеет некую ценность $ V_{i} $. Для начала мы предположим, что эти ценности --- независимые случайные величины, и каждый покупатель знает значение своей $ V_{i} $ и не знает значения остальных ценностей. 

%Ставку $ i $-го покупателя будем обозначать $ b_{i} $ (b от слова bid).


\begin{enumerate}
\item \indef{Кнопочный аукцион}\index{Кнопочный аукцион}. У каждого покупателя есть кнопка. Стартовая цена равна нулю. Изначально все покупатели давят на свои кнопки. Затем цена начинает расти. Как только игрок отпускает свою кнопку, он покидает аукцион. Аукцион прекращается, когда остается лишь один игрок, жмущий на кнопку. Товар достается этому игроку по цене, сложившейся на момент остановки.

Эта модель является упрощением реального английского аукциона. В реальности часто бывает, что игроки начинают активно играть лишь незадолго до окончания аукциона. Эта модель не предназначена для описания такого явления. В реальности игроки могут повышать текущую цену на произвольную величину, здесь же цена меняется непрерывно. Тем не менее, многие свойства английского аукциона кнопочная модель ловит.

\item \indef{Закрытый аукцион первой цены}\index{Аукцион первой цены}. Покупатели одновременно делают свои ставки. Товар достается тому покупателю, который назвал самую высокую цену. Победитель платит продавцу свою ставку.

Такой аукцион лучше всего подходит для моделирования голландского аукциона. Действительно, на голландском аукционе никакой другой информации, кроме того, по чем был продан товар ни один из игроков не получает. Голландский аукцион и аукцион первой цены стратегически эквивалентны --- множество стратегий у каждого игрока одно и то же, и функция выигрышей --- такая же. Тем не менее в реальности на цену аукциона оказывают влияет, например, такой фактор как скорость движения стрелки на часах.
\item \indef{Закрытый аукцион второй цены}\index{Аукцион второй цены}. Покупатели одновременно делают свои ставки. Товар достается тому покупателю, который назвал самую высокую цену. Победитель платит продавцу вторую по величине ставку, т.е. наибольшую ставку сделанную покупателями за исключением его самого.

Эта модель хорошо подходит для аукциона интернет-рекламы с одним рекламным местом.
\end{enumerate}

Чтобы разграничить реальность и модели, мы будем использовать слова <<Английский аукцион>>, <<Голландский аукцион>> для описания реальных явлений, а слова <<аукцион первой цены>>, <<аукцион второй цены>>, <<кнопочный аукцион>> --- для описания моделей.

Иногда вводят понятия: \indef{открытый аукцион}\index{открытый аукцион}, т.е. аукцион, где игроки видят ставки других игроков и \indef{закрытый аукцион},\index{закрытый аукцион} где игроки не видят ставок других игроков. По этой классификации кнопочный аукцион является открытым, а аукционы, где игроки делают ставки одновременно - закрытыми.

Для формального описания наших задач нам потребуется куча обозначений. Мы их будем вводить потихоньку, поэтому пугаться не стоит. Нужно всего лишь быть очень аккуратным и отличать заглавные и строчные буквы, например, $x$ и $X$. А листочек с обозначениями можно для удобства распечатать. Встречайте\ldots

\newpage

\begin{center}
\indef{Обозначения!}
\end{center}

\indef{Событие:}
\begin{itemize}
\item $W_{i}$ --- событие, состоящее в том, что победителем аукциона стал игрок $ i $.
\end{itemize}


\indef{Случайные величины:}
\begin{itemize}
\item $ X_{i} $ --- случайная величина, сигнал о ценности, получаемый игроком. Значение $ X_{i} $ известно игроку $ i $. Функцию распределения этой случайной величины обозначим $ F() $, а функцию плотности --- $ f() $.

\item $ V_{i} $ --- случайная величина, ценность товара для игрока $ i $. Если игрок точно знает ценность товара, то $ V_{i}=X_{i} $. Есть множество других возможностей, например, $ X_{i}=V_{i}+e_{i} $, где $ e_{i} $ --- некая случайная ошибка. 

\item $Bid_{i}$ --- случайная величина, ставка, которую сделает игрок $ i $ в равновесии Нэша. В симметричном равновесии Нэша:
\begin{equation}
Bid_{i}=b(X_{i})
\end{equation} 

\item $Pay_{i}$ --- случайная величина, выплата, которую делает игрок $ i $ в равновесии Нэша.

\item $ R $ --- случайная величина, доход продавца в равновесии Нэша:
\begin{equation}
R=Pay_{1}+Pay_{2}+\ldots+Pay_{n}
\end{equation}

\item $Profit_{i}$ --- случайная величина, выигрыш  игрока $ i $ в равновесии Нэша:
\begin{equation}
Profit_{i}=V_{i}\cdot 1_{W_{i}}-Pay_{i}
\end{equation}

\item $ Y_{1} $, \ldots, $ Y_{n-1} $ --- случайные величины $ X_{2} $, \ldots, $ X_{n} $ упорядоченные по убыванию. В частности, $ Y_{1}=\max\{X_{2},\ldots,X_{n}\} $ и $ Y_{n-1}=\min\{X_{2},\ldots,X_{n}\} $

\end{itemize}



\indef{Детерминистические функции:}

\begin{itemize}
\item $ b(\cdot ) $ --- неслучайная функция, зависимость ставки от сигнала в равновесии Нэша

\item $q(x)=\P(W_{1}|X_{1}=x)$ --- вероятность выигрыша первого игрока, если $ X_{1}=x $ в равновесии Нэша

\item $pay_{1}(x)=\E(Pay_{1}|X_{1}=x)$ --- средняя выплата первого игрока, если $ X_{1}=x $ в равновесии Нэша

\end{itemize}

При поиске равновесия Нэша полезно еще одно обозначение. Мы ищем наилучший ответ первого игрока на действия остальных, поэтому все игроки кроме первого используют равновесные стратегии, а первый игрок ставит константу $b_1$ вне зависиости от сигнала.

\begin{itemize}

%\item $\widehat{q}(b)=\P(W_{1}|Bid_{1}=b_{1})$ --- вероятность выигрыша, если используется стратегия $ Bid_{1}=b_{1} $.

%\item $\widehat{pay_{1}}(b_{1})=\E(Pay_{1}|Bid_{1}=b_{1})$ --- средняя выплата, если используется стратегия $ Bid_{1}=b_{1} $.

\item $\pi_{1}(x,b_{1})=\E(Profit_{1}|X_{1}=x ; Bid_{1}=b_{1})$ --- средний выигрыш первого игрока, если $ X_{1}=x $, он ставит константу $b_{1} $, а остальные игроки используют равновесные стратегии.
\end{itemize}

\newpage


Для полного описания моделей нужно сказать как распределены ценности $ V_{i} $ и какую информацию $ X_{i} $ о ценностях получают игроки. Наиболее популярен анализ двух частных случаев:
\begin{enumerate}
\item Частные независимые ценности\index{Частные независимые ценности}. Каждый игрок знает, какую ценность товар представляет для него. Т.е. $X_{i}=V_{i}$.
Такая ситуация возникает, если товар сложно перепродать вне аукциона или игроки не собираются делать этого. Для простоты ценности предполагают независимыми случайными величинами.
\item Общая ценность\index{Общая ценность}. Если товар можно легко перепродать и купить вне аукциона по стабильной цене, то ценность товара для каждого игрока определяется этой рыночной ценой товара. Т.е. $ V_{1}=V_{2}=V_{3}=\ldots=V_{n}=V $. При этом игроки могут не знать этого $ V $. Каждый игрок знает лишь свой сигнал $ X_{i} $, который зависит от $ V $ но не обязательно ему равен.
\end{enumerate}

В общем случае, который мы проанализируем, не будет ни равенства ценностей, ни независимости сигналов. Но начнем мы со случая частных независимых ценностей.

А теперь давайте найдем оптимальные стратегии игроков и средний доход продавца в трех моделях:

\section{Поиск оптимальных стратегий}

Кратко напомню предпосылки. Сигнал $ X_{i} $, который получает от Природы игрок $ i $ --- это и есть ценность товара для него, т.е. $ X_{i}=V_{i} $. Пусть ценности $ X_{i} $ будут независимыми и равномерными на $ [0;1] $ случайными величинами. Мы ограничимся поиском симметричного равновесия, т.е. равновесия, где все игроки используют одинаковую стратегию. Фактические ставки при этом могут отличаться! Стратегия --- это функция $b()$ от ценности, и даже если эти фукнции $ b() $ одиковые, величины $ b(X_{i}) $ будут разными в силу того, что ценности $ X_{i} $ будут разными.


До начала игры игроки ничем не отличаются: у них одинаковый закон распределения ценности товара, поэтому при анализе мы будем изучать поведение первого игрока. 

Поехали!
\begin{enumerate}
\item Аукцион первой цены. 

Предположим, что есть некая равновесная стратегия $ b(x) $. Предположим также, что она дифференциируема и возрастает по $ x $. 

Первый игрок выигрывает, если его ставка больше всех остальных, т.е. $ b_{1}>Bid_{i} $ для $ i\geq 2 $. Обозначим событие, состоящее в том, что первый игрок выиграл буквой $ W_{1} $. Его ожидаемый выигрыш равен:


\begin{equation}
\label{first_price_eq}
\pi_{1}(x,b_{1})=(x-b_{1})\P(W_{1}|X_{1}=x; Bid_{1}=b_{1})
\end{equation}

Вероятность:
\begin{equation}
\P(W_{1}|X_{1}=x; Bid_{1}=b_{1})=\P(b_{1}>Bid_{2} \cap b_{1}>Bid_{3} \cap \ldots \cap b_{1}>Bid_{n})
\end{equation}


Наша задача найти равновесие Нэша, т.е. такую ситуацию, когда использование стратегии $ b(x) $ является наилучшим действием, если остальные игроки используют такую же стратегию. Поэтому мы предположим, что все игроки кроме первого используют стратегию $ b(x) $, и найдем условие при котором первому тоже выгодно ее использовать.

\begin{multline}
\P(W_{1}|X_{1}=x; Bid_{1}=b_{1})=\\
=\P(b_{1}>b(X_{2}) \cap b_{1}>b(X_{3}) \cap \ldots \cap b_{1}>b(X_{n}))
\end{multline}

В силу независимости случайных величин $ X_{i} $:

\begin{multline}
\P(W_{1}|X_{1}=x; Bid_{1}=b_{1})=\\
=\P(b_{1}>b(X_{2}))\cdot \P(b_{1}>b(X_{3}))\cdot \ldots\cdot \P(b_{1}>b(X_{n}))
\end{multline}

В силу одинакового закона распределения $ X_{i} $:
\begin{equation}
\P(W_{1}|X_{1}=x; Bid_{1}=b_{1})=\P(b_{1}>b(X_{2}))^{n-1}
\end{equation}



Далее следует начало красивого трюка! 

\subsubsection*{Чудо-замена}\index{Чудо-замена}

Надеюсь все вы понимаете как делать замену переменных при решении задач. Входит, скажем, в уравнение переменная $ k $, а мы говорим, что вместо $ k $ мы будем писать $ f(m) $. Или наоборот, входит в уравнение $ f(m) $, а мы говорим, что вместо $ f(m) $ будем писать $ k $. Так вот сейчас мы сделаем замену. Мы заменим $ b_{1} $ на неизвестную (!) функцию!!! 

Итак, мы делаем замену $ b_{1}:=b(a) $. С помощью этой замены мы упростим вероятность:

\begin{multline}
\P(b_{1}>b(X_{2}))^{n-1}=\P(b(a)>b(X_{2}))^{n-1}=\\
=\P(a>X_{2})^{n-1}=\P(X_{2}<a)^{n-1}=F(a)^{n-1}
\end{multline}

На всякий случай: $ F(a)=\P(X_{i}\leq a) $ --- это функция распределения.

И наша прибыль имеет вид:

\begin{equation}
\pi_{1}=(x-b(a))(F(a))^{n-1}
\end{equation}


Вместо максимизации по $ b_{1} $ нам придется максимизировать по $ a $. Для нахождения оптимальной стратегии первого игрока приравниваем производную по $ a $ к нулю:

\begin{equation}
\frac{\partial \pi_{1}}{\partial a}=-b'(a)(F(a))^{n-1}+(x-b(a))(n-1)F(a)^{n-2}f(a)=0
\end{equation}


После упрощения:

\begin{equation}
-b'(a)F(a)+(x-b(a))(n-1)f(a)=0
\end{equation}


Завершение красивого трюка! Мы хотим потребовать, чтобы первому игроку тоже было оптимально использовать стратегию $ b() $. Ценность товара для первого игрока мы обозначили $ x $, значит оптимальное $ b_{1} $ должно равняться $ b(x) $. А мы делали замену $ b_{1}=b(a) $. Значит в точке оптимума $ b(x)=b(a) $ или $ x=a $. 

\begin{equation}
\label{first_price_final_diffeq}
-b'(x)F(x)+(x-b(x))(n-1)f(x)=0
\end{equation}


Это дифференциальное уравнение можно решить в общем виде, но мы ограничимся нашим равномерным случаем.

Для равномерной случайной на отрезке $ [0;1] $ получаем $ f(x)=1 $ и $ F(x)=x $:

\begin{equation}
-b'(x)x+(x-b(x))(n-1)=0
\end{equation}

Это линейное дифференциальное уравнение\ldots Его можно решить стандартными методами, скажем, вариацией постоянной, а можно угадать вид решения. Мы пойдем путем угадывания, но я предполагаю, что все могут решить его честно! Раз фигурирует производная и первая степень $ x $, попробуем $b(x)=kx+m $:

\begin{equation}
-kx+(x-kx-m)(n-1)=0
\end{equation}

Собираем коэффициенты при $ x $:

\begin{equation}
-m(n-1)+x(-k+(1-k)(n-1))=0
\end{equation}

Это должно быть тождеством для любого $ x $, значит $ m=0 $ и  $-k+(1-k)(n-1)=0$. Находим $ k $, $ k=\frac{n-1}{n} $.

Оптимальная стратегия первого и всех остальных игроков: $ b(x)=\frac{n-1}{n}x $.


Комментарии:

\begin{enumerate}
\item Т.к. $ \frac{n-1}{n}<1 $ игроки занижают свою истинную ценность в равновесии Нэша. Причем, чем меньше игроков, тем сильнее занижаются ставки по сравнению с субъективной ценностью товара.
\item Можно обойтись без красивого трюка. Для этого можно рассмотреть функцию, обратную к функции $ b() $ и применить ее внутри вероятности. 
\item В равномерном случае можно обойтись и без дифференциальных уравнений. Для этого достаточно сделать удачную догадку до начала решения. Т.е. начать со слов: предположим, что оптимальная стратегия имеет вид $ b(x)=kx+m $ и максимизировать по $ k $ и $ m $.
\item Тот, кто попробует честно решить линейное дифференциальное уравнение, обнаружит, что общее решение имеет вид $ b(x)=c\cdot x^{-(n-1)}+\frac{n-1}{n}x $. Почему мы берем $ c=0 $? Наше дифференциальное уравнение является необходимым условием полученным в предположении, что $ b(x) $ --- возрастающая функция. Только решение при $ c=0 $ является возрастающим. 
\item Мы проверили только необходимое условие максимума --- первая производная равна нулю. Желающие могут взять вторую производную и убедиться, что она меньше нуля, как и положено в максимуме. Позже мы в общем случае докажем, что достаточное условие выполнено.
\item Мы доказали, что найденная $ b(x) $ --- единственное симметричное равновесие Нэша, где $ b(x) $ --- возрастающая функция. Мы не искали равновесия Нэша, где $ b(x) $ хотя бы иногда убывает.
\end{enumerate}


\begin{myex} Решение <<в лоб>>, без чудо-замены.

Начнем с того, что прибыль представима в виде:
\begin{equation}
\pi(x,b_{1})=(x-b_{1})\P(b(X_{2})<b_{1})^{n-1}
\end{equation}

По нашим предположениям функция $ b() $ строго возрастает, значит у нее есть обратная. Обозначим ее $ b^{-1}() $:

\begin{equation}
\pi(x,b_{1})=(x-b_{1})\P(X_{2}<b^{-1}(b_{1}))^{n-1}=(x-b_{1})F(b^{-1}(b_{1}))^{n-1}
\end{equation}

Берем производную по $ b_{1} $:
\begin{multline}
\frac{\partial \pi(x,b_{1})}{\partial b_{1}}=-F(b^{-1}(b_{1}))^{n-1}+\\
+(x-b_{1})(n-1)F(b^{-1}(b_{1}))^{n-2}f(b^{-1}(b_{1}))\cdot \frac{db^{-1}(b_{1})}{db_{1}}=0
\end{multline}

Отсюда как-то неявно выражается $ b_{1} $ как функция от $ x $. Но мы на самом деле знаем ответ! Мы уже предположили, что ситуация, когда все игроки используют функцию $ b() $ --- это NE. Значит если все игроки кроме первого используют $ b() $, то и первому игроку оптимально ее использовать! Значит решением должно являться $ b_{1}=b(x) $. Поэтому при подстановке $ b_{1}=b(x) $, должно получаться тождество верное при любых $ x $.

При подстановке $ b_{1}=b(x) $ величина $ b^{-1}(b_{1}) $ превращается в $ x $. Собственно, это и есть $ a $ при чудо-замене\ldots Получаем дифференциальное уравнение:

\begin{equation}
-F(x)^{n-1}+(x-b(x))(n-1)F(x)^{n-2}f(x)\left.\frac{db^{-1}(b_{1})}{db_{1}}\right|_{b_{1}=b(x)}=0
\end{equation}

Сокращаем $ F^{n-2} $:

\begin{equation}
-F(x)+(x-b(x))(n-1)f(x)\left.\frac{db^{-1}(b_{1})}{db_{1}}\right|_{b_{1}=b(x)}=0
\end{equation}

Остается вспомнить, что производная обратная функции --- это единица делить на производную исходной функции и наше уравнение сопадает с \ref{first_price_final_diffeq}.
\end{myex}

\item Аукцион второй цены. 
Раз все игроки одинаковые, ограничимся рассмотрением первого игрока. Результат аукциона для него зависит от его собственной ставки и от максимальной ставки остальных игроков. Ценность товара для первого игрока у нас обозначена $ X_{1} $. Обозначим максимальную ставку остальных игроков --- $ m $. Величину $ X_{1} $ игрок знает, а $ m$ --- нет. В наших обозначениях $ m=b(Y_{1}) $, но это не существенно.

Сравним две стратегии первого игрока: $b_{1}=X_{1}  $, $ b_{1}=X_{1}+\Delta $. Числа $ X_{1} $ и $ X_{1}+\Delta $ разбивают числовую прямую на три интервала. Неизвестное $ m $ попадет в один из этих трех интервалов. Запишем выигрыш первого игрока в табличку. Если $ b_{1}<m $, то он ничего не платит и не получает товар. Если $ b_{1}>m $, то игрок получает товар ценностью $ X_{1} $ и платит $ m $:

\begin{tabular}{c|ccc}
& $ m \in (-\infty;X_{1}) $ & $ m \in (X_{1};X_{1}+\Delta) $ & $ m \in (X_{1}+\Delta;+\infty) $ \\ 
\hline 
$ b_{1}=X_{1}$         & $ X_{1}-m $ & 0 & 0 \\ 
$ b_{1}=X_{1}+\Delta $ & $ X_{1}-m $ & $ X_{1}-m $ & 0 \\ 
\end{tabular} 

Мы видим, что в двух случаях из трех стратегии приносят одинаковый выигрыш. Различие есть только если $ m \in (X_{1};X_{1}+\Delta) $. Стратегия $ b_{1}=X_{1}$ приносит нулевой выигрыш, а стратегия $  b_{1}=X_{1}+\Delta  $ приносит выигрыш $ X_{1}-m<0 $. Значит стратегия $ b_{1} $ нестрого доминирует любую стратегию вида $ b_{1}=X_{1}+\Delta $ при $ \Delta>0 $. Делать ставку выше своей ценности не выгодно!


Аналогично сравним стратегии $ b_{1}=X_{1} $ и $ b_{1}=X_{1}-\Delta $:

\begin{tabular}{c|ccc}
& $ m \in (-\infty;X_{1}-\Delta) $ & $ m \in (X_{1}-\Delta;X_{1}) $ & $ m \in (X_{1};+\infty) $ \\ 
\hline 
$ b_{1}=X_{1}$         & $ X_{1}-m $ & $X_{1}-m$ & 0 \\ 
$ b_{1}=X_{1}-\Delta $ & $ X_{1}-m $ & 0 & 0 \\ 
\end{tabular} 

На этот раз разница в выигрышах возникает если $ m \in (X_{1}-\Delta;X_{1}) $. Стратегия $ b_{1}=X_{1}$ приносит выигрыш $  X_{1}-m>0 $. Значит стратегия $ b_{1} $ нестрого доминирует любую стратегию вида $ b_{1}=X_{1}-\Delta $ при $ \Delta>0 $.

Вывод. Существует равновесие Нэша, в котором все игроки используют стратегию $ b(x)=x $, т.е. правдиво декларируют свои ценности.

Комментарии:
\begin{enumerate}
\item Равномерность распределения нигде не использовалась в решении. Значит наше рассуждение проходит для любого непрерывного закона распределения $ X $.
Почему нам важна непрерывность распределения? Надеюсь, кто-нибудь обратил внимание, что интервалы для $ m $ были открытые, мы не рассматривали случай, когда $ m $ идеально точно попадает в его границу. Если распределение ценностей непрерывно, то вероятность того, что $ m $ будет равняться конкретному числу равна нулю. Исключив эти случаи из рассмотрения мы не изменили ожидаемую прибыль первого игрока, а значит не изменили его оптимальную стратегию. 

В случае дискретного распределения доходностей очень важным становится правило, согласно которому распределяется товар, если ставки совпали. В непрерывном случае вероятность совпадения ставок равна нулю, и никакое правило распределения товара при <<ничьей>> не влияет на оптимальные стратегии.
\item Также в решении нигде не использовалась независимость $ X_{i} $. Значит рассуждение проходит и для зависимых ценностей. Единственное ограничение: вероятность совпадения ценностей должна равняться нулю.
\end{enumerate}


\begin{myex}
Можно решить аукцион второй цены таким же способом, как и аукцион первой цены. В этом случае:
\begin{multline}
\pi(x,b_{1})=\E((X_{1}-b(Y_{1}))1_{b_{1}>b(Y_{1})}|X_{1}=x,Bid_{1}:=b_{1})=\\
=\E((x-b(Y_{1}))1_{b_{1}>b(Y_{1})})
\end{multline}
Поскольку $ X_{i} $ независимы условное мат. ожидание превратилось в безусловное. Чудо-замена $ b_{1}=b(a) $ и предположение о возрастании функции $ b() $ позволяют упростить выражение:
\begin{multline}
\pi(x,b(a))=x\P(Y_{1}<a)+\E(b(Y_{1})1_{Y_{1}<a})=\\
=x\int_{0}^{a}p_{Y_{1}}(t)dt-\int_{0}^{a}b(t)p_{Y_{1}}(t)dt
\end{multline}
Берем производную по $ a $:
\begin{equation}
\frac{\partial \pi(x,b(a))}{\partial a}=xp_{Y_{1}}(a)-b(a)p_{Y_{1}}(a)
\end{equation}
Мы предположили, что $ b() $ --- это равновесная стратегия, значит при ценности $ x $ игроку должно быть оптимально ставить $ b_{1}=b(x) $. Кроме того мы делали замену $ b_{1}=b(a) $. Значит производная обращается в ноль при $ a=x $:
\begin{equation}
xp_{Y_{1}}(x)-b(x)p_{Y_{1}}(x)=0
\end{equation}
И отсюда мы получаем решение $b(x)=x$.

Недостаток этого способа в том, что он говорит только что $ b(x)=x $ --- равновесие Нэша. А способ с доминированием стратегий говорит, что это не просто равновесие, а равновесие в нестрого доминирующих стратегиях.
\end{myex}

\item Кнопочный аукцион. 

Снова рассмотрим первого игрока. Если он видит,например, что другие игроки долго давят свои кнопки, он может сделать вывод, что их ценности товара высоки. Наблюдая за другими, он получает информацию о них, но не о себе! Его ценность не зависит от их ценностей! Ситуция резко изменится, когда мы будем рассматривать зависимые ценности в следующих лекциях. А пока наблюдение за другими не дает нашему игроку никакой полезной информации, кроме того, остался ли он уже один в игре, или еще нет.

Естественно, как только игрок остался один в игре, победитель сразу определен. Значит стратегия игрока не зависит, от того, сколько еще игроков осталось кроме него. Еще двое или трое, или семеро --- никакой разницы. Значит еще до начала аукциона, узнав свою ценность $ X $, игрок может уже спланировать свои действия: <<я буду давить на кнопку до тех пор, пока цена не дойдет до некоей цены $ b $ или пока я не выиграю аукцион.>> 

Итак, действия игрока описывается его числом $ b_{i} $. Представим теперь, что игроки просто пишут свои $ b_{i} $ на бумажках, а на кнопки давят роботы, согласно этим $ b_{i} $. Кто победит на аукционе? Победит тот, кто написал наибольшее $ b_{i} $. А сколько он заплатит? Он заплатит вторую по величине $ b_{i} $!

Получается, что при независимых ценностях, кнопочный аукцион полностью эквивалентен аукциону второй цены. А его мы уже решали. Оптимальная стратегия: $ b(x)=x $. 

Когда ценности будут коррелированы, кнопочный аукцион будет отличаться от аукциона второй цены.

\end{enumerate}


\section{Теорема об эквивалентности доходностей}

Чтобы не повторяться введем:

\begin{mydef}
Закон распределения случайной величины $ X $ назовем \indef{регулярным}\index{Регулярное распределение}, если существуют такие числа $a$ и $b$, что функция распределения $ F $ строго возрастает и непрерывна на $ [a;b] $, $ F(a)=0 $ и $ F(b)=1 $.
\end{mydef}


Мы в этом курсе всегда будем рассматривать регулярное распределение на $ [0;1] $. Это нисколько нас не ограничивает, т.к. вопрос выбора начала и конца отрезка --- это вопрос выбора масштаба, в котором измеряются денежные суммы. Может быть <<один>> --- это один миллион рублей. Зато обозначения становятся проще.


\begin{myth} Теорема об одинаковой доходности. Revenue equivalence theorem. \index{Теорема об одинаковой доходности}


Если:

\begin{itemize}
\item[RE1.] На аукционе выставлен один товар 
\item[RE2.] За право получить товар торгуются $ n $ игроков
\item[RE3.] Ценности товара для разных игроков одинаково распределенны и независимы
\item[RE4.] Ценности имеют регулярное распределение на отрезке $ [0;1] $
\item[RE5.] В равновесии товар достается тому игроку, для которого он ценнее всего
\item[RE6.] В равновесии средний выигрыш игрока с минимальной ценностью (у нас с ценностью 0) равен 0
\item[RE7.] Покупатели нейтральны к риску
\end{itemize}

То:

Средний доход продавца не зависит от конкретного механизма проведения аукциона

\end{myth}


\begin{proof}

Доказательство состоит из трех шагов. Двух простых и третьего, позапутаннее, --- связанного с теоремой об огибающей\ldots

Шаг 1. Рассмотрим игрока с ценностью $ x $. Какова вероятность того, что он выиграет аукцион? Из требования RE5 следует, что это вероятность того, что ценность остальных игроков ниже $ x $. Применяя требования RE1-RE4 получаем, что искомая вероятность, обозначим ее $ q(x) $, равна 
\[ q(x)=F(x)^{n-1} \]

Шаг 2. Заметим, что средняя выручка продавца --- это сумма средних платежей всех игроков.


Шаг 3. Оказывается, что средний платеж игрока однозначно выводится из вероятности, упомянутой в шаге 1 и условия RE6. А именно, вот-вот мы докажем, что средняя выплата игрока определяется по формуле:

\begin{equation}
\label{pay_eq}
pay(x)=xq(x)-\int_{0}^{x}q(t)dt 
\end{equation}

Доказательство на самом деле занимает две или три строчки, но перед ними нужно ввести кучу обозначений. Итак\ldots

Мы выбрали конкретного игрока. Рассмотрим ситуацию, в которой остальные игроки используют равновесные стратегии. Вероятность того, что наш игрок выиграет аукцион зависит только от его ставки $ b $, так как стратегии остальных зафикисрованы. Обозначим ее $ \widehat{q}(b) $. Если игрок выигрывает аукцион, то он что-то платит, причем не обязательно свою ставку! Если не выигрывает, то ничего не платит. Среднее значение этого платежа опять же зависит только от его ставки $ b $, обозначим его $ \widehat{pay}(b) $.

Средний выигрыш игрока, тогда определяется по формуле:

\begin{equation}
\pi(x,b)=x\widehat{q}(b)-\widehat{pay}(b)
\end{equation}

У игрока есть равновесная стратегия $ b(x) $, которая по определению равновесия Нэша, является наилучшим ответом на действия других игроков. 

При подстановке этой наилучшей стратегии  $ b(x) $ вместо $ b $ мы получаем определения трех новых функций:

\[ q(x):=\widehat{q}(b(x)) \]

\[ pay(x)=\widehat{pay}(b(x)) \]

\[ \pi^{*}(x)=\pi(x,b(x))=xq(x)-pay(x) \]

Для ясности: единственная разница между функциями $ \widehat{q}() $ и $ q() $ состоит в том, что первая зависит от ставки, а вторая --- от ценности. Повесив на стену столько ружей, пора стрелять!

Находим производную:

\begin{equation}
\frac{d \pi^{*}(x)}{dx}=\frac{d \pi(x,b(x))}{dx}=\frac{\partial \pi}{\partial x}+\frac{\partial \pi}{\partial b}\frac{d b }{d x}
\end{equation}

А теперь вспомним, что оптимальная стратегия $ b(x) $ находится из условия $ \frac{\partial \pi}{\partial b}=0 $. Значит:

\begin{equation}
\frac{d \pi^{*}(x)}{dx}=\left.\frac{\partial \pi}{\partial x}\right|_{b=b(x)}
\end{equation}

Это, между нами говоря, была теорема об огибающей. Упрощаем производную:

\begin{equation}
\left.\frac{\partial \pi(x,b)}{\partial x}\right|_{b=b(x)}=\widehat{q}(b)|_{b=b(x)}=q(x)
\end{equation}

Вот и все! Кстати, это имеет легкую смысловую интерпретацию. Частная производная говорит нам, что случится с ожидаемым выигрышем, если мы будем менять ценность $x$, но не будем менять стратегию $ b $. Не меняя стратегию мы не влияем на вероятность выигрыша и на наш средний платеж организаторам аукциона. Естественно, мы должны получить вероятность выигрыша.

Осталось записать это в интегральной форме:

\begin{equation}
\pi^{*}(x)=\pi^{*}(0)+\int_{0}^{x}q(t)dt
\end{equation}

Условие RE6 говорит, что $ \pi^{*}(0)=0 $ и мы можем увидеть, что:

\begin{equation}
xq(x)-pay(x)=\int_{0}^{x}q(t)dt
\end{equation}

Что и требовалось доказать.
\end{proof}

Примечания. 
\begin{enumerate}
\item Теорема говорит только о равенстве среднего дохода. Она не говорит, что доход продавца при данных конкретных ценностях покупателей не зависит от формы аукциона. 
\item Теорема не говорит, что равновесие, в котором игрок с наивысшей ценностью получает товар, существует. Она, наоборот, опирается на существование такого равновесия: если такое равновесие есть, то средний доход продавца не зависит от формы проведения аукциона. Поэтому использовать теорему нужно аккуратно. 

Если в аукционе товар достается тому, кто сделал наибольшую ставку, то часто помогает такая цепочка рассуждений: Предположим, что равновесие, где товар достается игроку с наибольшей ценностью есть. Тогда мы можем использовать теорему. Она нам поможет (сейчас мы на примере это увидим) найти равновесную стратегию. Затем мы проверяем, что эта равновесная стратегия $ b(x) $ является возрастающей функцией по $ X $. И мы подобно барону Мюнхаузену вытащили сами себя за волосы! Если по правилам аукциона товар достается сделавшему наибольшую ставку, а наибольшая ставка соответствует наибольшей ценности, значит теорему можно было применять!
\end{enumerate}


Наши три модели удовлетворяют условиям теоремы, поэтому средний доход продавца в них одинаковый:

\[ \E(R^{B})=\E(R^{FP})=\E(R^{SP}) \]

Средний доход продавца равен $ n $ умножить на среднюю выплату от первого игрока продавцу, поэтому воспользуемся формулой для средней выплаты от игрока продавцу: 

\[ pay(x)=xq(x)-\int_{0}^{x}q(t)dt \]

При равномерном распределении ценностей, т.е. $ q(x)=F(x)^{n-1}=x^{n-1} $:

\begin{equation}
pay(x)=\frac{n-1}{n}x^{n}
\end{equation}

Воспользуемся равномерностью второй раз:

\begin{equation}
\E(pay(X_{1}))=\E\left(\frac{n-1}{n}X_{1}^{n}\right)=\frac{n-1}{n}\int_{0}^{1} t^{n} dt=\frac{n-1}{n(n+1)}
\end{equation}

Умножаем на $ n $ и получаем:

\begin{equation}
\E(R^{B})=\E(R^{FP})=\E(R^{SP})=\frac{n-1}{n+1}
\end{equation}


А сейчас мы с помощью этой теоремы в два счета получим решение аукциона первой цены не только для равномерного случая. 


\begin{myex} \label{use_ret} Решение аукциона первой цены для случай произвольного регулярного распределения ценностей. Предположим, что есть некое равновесие, и теорему об одинаковой доходности можно применять.

На аукционе первой цене средний платеж игрока равен его ставке помноженной на вероятность выигрыша:

\begin{equation}
\label{first_price_pay_eq}
pay(x)=b(x)q(x)
\end{equation}

Таким образом уравнение \ref{pay_eq} имеет вид:

\begin{equation}
xq(x)-b(x)q(x)=\int_{0}^{x}q(t)dt
\end{equation}

Отсюда мы находим оптимальную стратегию:

\begin{equation}
\label{first_price_b_eq}
b(x)=x-\frac{\int_{0}^{x}q(t)dt}{q(x)}
\end{equation}

Напомним, что условия RE1-RE5 говорят нам, что $ q(x)=F(x)^{n-1} $. Это и есть решение аукциона первой цены для произвольной регулярной $ F $.

Остается проверить, что теорему можно было применять! Берем производную $ \frac{db(x)}{dx} $ и убеждаемся, что она строго положительна! 

Убедитесь кстати, что при подстановке $ F(t)=t $ на $ [0;1] $ мы получаем наш результат для равномерно распределенных ценностей.
\end{myex}




\section{Пример с коррелированными ценностями}


Сравним на примере доходы аукциона первой и второй цены при коррелированных ценностях.

В аукционе участвуют два игрока. Предположим, что совместная функция плотностей на множестве $ x_{1},x_{2}\in [0;1] $ имеет вид:

\begin{equation}
f(x_{1},x_{2})=x_{1}+x_{2}
\end{equation}

Наша задача найти равновесие Нэша для аукциона первой и для аукциона второй цены, а также среднюю выручку продавца.

\begin{enumerate}
\item Аукцион первой цены. Считаем ожидаемый выигрыш первого игрока, если его ценность равна $ x $, а ставит он $ b_{1} $. Отличие от формулы \ref{first_price_eq} состоит в том, что знание $ x $ содержит в себе информацию о ценности, и следовательно, ставке, второго игрока. Поэтому мы используем условную вероятность:

\begin{equation}
\pi_{1}(x,b_{1})=(x-b_{1})\P(b_{1}>Bid_{2} |X_{1}=x)
\end{equation}

Предположим, что существует симметричное равновесие Нэша, в котором все игроки делают ставки согласно функции $ b(x) $. Предположим, что эта функция дифференциируема и возрастает по $ x $. 

Снова рассмотрим ситуацию, в которой все игроки кроме первого используют функцию $ b() $ для своих ставок и найдем оптимальное поведение первого игрока. В нашем частном случае <<все остальные>> --- это только второй игрок. Т.е. $ Bid_{2}=b(X_{2}) $.

Снова сделаем магическую замену $ b_{1} $ на пока неизвестную функцию $ b(a) $. В силу предположения о возрастании  $ b(x) $ условие $ b(a)>b(X_{2}) $ равносильны тому, что $ a>X_{2} $.

После магической подстановки наша прибыль имеет вид:

\begin{equation}
\pi_{1}=(x-b(a))\P(a>X_{2} |X_{1}=x)
\end{equation}


Чтобы брать производную по $ a $ вспомним немного теорию вероятностей:

Из совместной функции плотности $ f(x_{1},x_{2}) $ можно получить:

Сначала частную функцию плотности $ X_{1} $:

\begin{equation}
f_{X_{1}}(x_{1}):=\int_{0}^{1} f(x_{1},x_{2}) dx_{2}
\end{equation}

В нашем случае (интеграл берите сами) $ f_{X_{1}}(x_{1})=\frac{1}{2}+x_{1} $.

А затем и условную функцию плотности по принципу:

\begin{equation}
f(x_{2}|x_{1}):=\frac{f(x_{1},x_{2})}{f_{X_{1}}(x_{1})}
\end{equation}

В нашем случае получаем $ f(x_{2}|x_{1})=\frac{x_{1}+x_{2}}{1/2+x_{1}} $

А из условной функции плотности можно получить условную функцию распределения:

\begin{equation}
F(x_{2}|x_{1}):=\int_{0}^{x_{2}} f(t|x_{1}) dt
\end{equation}

В нашем случае получаем $F(x_{2}|x_{1}):=\frac{x_{1}x_{2}+x_{2}^{2}/2}{1/2+x_{1}}$.

Но ведь $ \P(X_{2}<a|X_{1}=x) $ это и есть условная функция распределения, $ F_{X_{2}|X_{1}}(a|x) $.

Значит наша прибыль в вероятностных терминах записывается как:

\begin{equation}
\pi_{1}=(x-b(a)) F_{X_{2}|X_{1}}(a|x)
\end{equation}

Берем производную по $ a $ и приравниваем к нулю:

\begin{equation}
\frac{\partial \pi_{1}}{\partial a}=-b'(a) F_{X_{2}|X_{1}}(a|x)+(x-b(a))f_{X_{2}|X_{1}}(a|x)=0
\end{equation}

Снова завершаем магический трюк. Мы должны потребовать, чтобы оптимальной стратегий первого игрока была бы функция $b_{1}=b(x)  $. Но мы использовали замену $ b_{1}=b(a) $, значит $ x=a $:


\begin{equation}
-b'(x) F_{X_{2}|X_{1}}(x|x)+(x-b(x))f_{X_{2}|X_{1}}(x|x)=0
\end{equation}

В результате мы получили дифференциальное уравнение:

\begin{equation}
b'(x)=(x-b(x))\frac{f_{X_{2}|X_{1}}(x|x)}{F_{X_{2}|X_{1}}(x|x)}
\end{equation}

В нашем частном случае: $ f(x|x)=\frac{2x}{1/2+x} $, $ F(x|x)=\frac{1.5x^2}{1/2+x} $.

Получаем дифференциальное уравнение:

\begin{equation}
b'=(x-b(x))\frac{4}{3x}
\end{equation}

Мы же везунчики, правда у него будет линейное решение?

Можно подбором получить $ b(x)=\frac{4}{7}x $. 

Если же решать честно, то общее решение имеет вид  $ b(x)=c\cdot x^{-4/3}+\frac{4}{7}x $. Но мы ищем стратегию, которая возрастает по $ x $, поэтому $ c=0 $.


Настала очередь дохода продавца. Он равен удвоенной ожидаемой выплате первого игрока. 
Первый игрок платит $ \frac{4}{7}X_{1} $ только если $ X_{1}>X_{2} $. Значит:

\begin{equation}
\E(R^{FP})=2\E\left(\frac{4}{7}X_{1}\cdot 1_{X_{1}>X_{2}}\right)
\end{equation}

Задача свелась к двойному интегралу:

\begin{equation}
\E(\frac{4}{7}X_{1}\cdot 1_{X_{1}>X_{2}})=\int_{0}^{1} \int_{0}^{x_{1}}  \frac{4}{7}x_{1}  f(x_{1},x_{2}) dx_{2} dx_{1}
\end{equation}

Подставляем функцию плотности и после взятия интеграла получаем:

\begin{equation}
\E(R^{FP})=\frac{3}{7}\approx 0.4286
\end{equation}


\item Аукцион второй цены. Логика решения такая же, как и в случае независимых ценностей. Рассматриваем поведение первого игрока. Поскольку игроков всего два, $ m=b_{2} $. Отличие от случая независимыми ценностями состоит в том, что случайные величины $ m $ и  $ X_{1} $ зависимы. Но этот факт никак не влияет на логику решения. Поэтому снова оказывается, что стратегия $ b_{1}=X_{1} $ нестрого доминирует любую другую стратегию первого игрока.

Считаем ожидаемый доход продавца. Он равен удвоенной ожидаемой выплате первого игрока. 
Первый игрок платит $ X_{2} $ только если $ X_{1}>X_{2} $. Значит:

\begin{equation}
\E(R^{SP})=2\E(X_{2}\cdot 1_{X_{1}>X_{2}})
\end{equation}

Задача свелась к двойному интегралу:

\begin{equation}
\E(X_{2}\cdot 1_{X_{1}>X_{2}})=\int_{0}^{1} \int_{0}^{x_{1}}  x_{2}  f(x_{1},x_{2}) dx_{2} dx_{1}
\end{equation}

Подставляем функцию плотности и после взятия интеграла получаем:

\begin{equation}
\E(R^{SP})=5/12\approx 0.4167
\end{equation}

\end{enumerate}

Таким образом, для данного совместного распределения доходностей аукционы первой и второй цены не одинаково выгодны для продавца! Мы исследуем подробнее случай связанных доходностей позже.



\section{Упражнения}


\begin{enumerate}
\item В моделях аукциона первой и второй цены с независимыми, равномерными на $ [0;1] $ ценностями покупателей приведите примеры
\begin{enumerate}
\item Вектора ценностей, при котором для продавца лучше аукцион первой цены
\item Вектора ценностей, при котором для продавца лучше аукцион второй цены
\end{enumerate}


\item Рассмотрите покупателей с независимыми ценностями, имеющими функцию плотности $ f(x)=2x $ на отрезке $ [0;1] $. Найдите в явном виде оптимальные стратегии и среднюю прибыль продавца.



\item Докажите, что формулу $ pay(x)=xq(x)-\int_{0}^{x}q(t)dt$ можно представить в виде:

\begin{equation}
pay(x)=pay(0)+\int_{0}^{x}t \cdot \frac{dq(t)}{dt}\cdot dt
\end{equation}



\item Аукцион <<Платят все!>> \index{Аукцион <<Платят все>>}. Покупатели одновременно делают ставки. Товар достается тому, кто назвал наибольшую ставку, но платят все игроки. Каждый платит свою ставку. Ценности товара для покупателей имеют независимое регулярное распределение с функцией распределения $ F() $. 

Используя трюк с теоремой об одинаковых доходностях (см. пример \ref{use_ret}) найдите оптимальные стратегии игроков, $ b(x) $.

Какой вид имеют оптимальные стратегии, если $ X_{i} $ равномерны на $ [0;1] $? Чему в этом случае будет равен ожидаемый доход продавца?




\item Наследство\index{Наследство}. Двум сыновьям достался земельный участок в наследство. Отец не хотел, чтобы участок был разделен, поэтому по завещанию установлены следующие правила: два брата одновременно делают ставки. Участок получает тот, кто сделал большую ставку. При этом получивший участок выплачивает свою ставку проигравшему. Найдите равновесие Нэша, если ценности участка независимы и равномерны на $ [0;1] $.

\item Аукцион <<Победитель платит чужую среднюю>>\index{Аукцион <<Победитель платит чужую среднюю>>}. Покупатели одновременно делают ставки. Товар достается тому, кто назвал наибольшую ставку. Победитель платит среднюю арифметическую ставок остальных игроков. Ценности товара для покупателей независимы и равномерно распределены на $ [0;1] $. Найдите оптимальные стратегии игроков, $ b(x) $, средний доход продавца.

Hint: А может у дифференциального уравнения простое линейное решение?


\item Аукцион с дискретными ценностями. В аукционе участвуют два покупателя. Ценности товара для покупателей независимы и имеют дискретное распределение: $ X_{i} $ равновероятно принимает значения $ 0 $ и $ 1 $. Аукцион проходит по следующим правилам: продавец предлагает товар по цене $ a $, где $ a $ --- это некая константа, $ a\in (0;2/3) $. Игроки одновременно решают, подходит ли им эта цена или нет. Если один сказал <<да>>, а другой <<нет>>, то товар достается тому, кто сказал <<да>> и он платит $ a $. Если оба сказали <<нет>>, то товар отдается бесплатно случайно выбираемому игроку. Если оба сказали <<да>>, то товар отдается по цене $ a $ случайно выбираемому игроку. 

Найдите равновесие Нэша (хотя бы одно).

Зависит ли равновесный доход аукциониста от $ a $? Применима ли теорема об одинаковой доходности и почему?

При каком $ a $ доход продавца будет максимальным?

Hint1: На всякий случай, а то курс теории игр уже кончился :), во-первых, равновесия бывают в смешанных стратегиях, во-вторых, чистых стратегий у каждого игрока здесь четыре. Стратегия --- это функция от ценности, значит у игрока есть, например, стратегия <<если $ X=0 $, то говорю 'нет', если $ X=1 $, то говорю 'да'>>.

Hint2: если задача кажется слишком сложной, решите ее для конкретного $ a $, скажем, для $ a=0.1 $, а затем попробуйте снова. Это, кстати, один из немногих универсальных приемов решения всех задач: <<Я не хочу решать эту задачу, поэтому буду решать более простую!>>


\end{enumerate}


\section{Решения упражнений}

\begin{enumerate}
\item В качестве примера возьмем аукцион двух игроков.

а) Если $ X_{1}=0.2 $, $ X_{2}=0.6 $, то на аукционе второй цены продавец получит $ 0.2 $ (вторую по величине ставку), а на аукционе первой цены продавец получит $ 0.3 $ (т.к. оптимальная стратегия имеет вид $ b(x)=\frac{n-1}{n}x=\frac{1}{2}x $).

б) Если $ X_{1}=0.4 $, $ X_{2}=0.6 $, то на аукционе второй цены продавец получит $ 0.4 $ (вторую по величине ставку), а на аукционе первой цены продавец получит $ 0.3 $ (т.к. оптимальная стратегия имеет вид $ b(x)=\frac{n-1}{n}x=\frac{1}{2}x $).

\item Подставляем $ F(x)=x^{2} $, значит $ q(x)=(x^{2})^{n-1}=x^{2n-2} $. Подставляем $ q(x) $ в \ref{first_price_b_eq}. Получаем $ b(x)=\frac{2n-2}{2n-1}x $. 

Полученную $ b(x) $ подставляем в \ref{first_price_pay_eq}. Получаем $ pay(x)=\frac{2n-2}{2n-1}x^{2n-1} $. 

Считаем ожидаемую выплату первого игрока:

\begin{multline}
\E(pay(X_{1})=\int_{0}^{1}pay(t)f(t)dt=\int_{0}^{1}\frac{2n-2}{2n-1}t^{2n-1}\cdot 2tdt=\\
=\frac{4(n-1)}{(2n-1)(2n+1)}
\end{multline}

И умножаем на число игроков:

\begin{equation}
\E(R^{FP})=\frac{4n(n-1)}{(2n-1)(2n+1)}
\end{equation}

\item Используем формулу интегрирования по частям.


\item Используем уравнение из теоремы об одинаковой доходности

\begin{equation}
xq(x)-pay(x)=\int_{0}^{x}q(t)dt
\end{equation}

В данном случае $ pay(x)=b(x) $, так как ставка платится вне зависимости от того, кому достанется товар. Значит: 

\begin{equation}
\label{NE_all_pay}
b(x)=xq(x)-\int_{0}^{x}q(t)dt
\end{equation} 
где $ q(x)=F(x)^{n-1} $

Можно решить и по-другому --- явно выписав задачу максимизации игрока и получив дифференциальное уравнение.


\item Эта игра не аукцион в чистом виде, т.к. игрок тоже может получить деньги.
Выписываем прибыль первого игрока:
\begin{equation}
\pi_{1}=(x-b_{1})\P(b(X_{2})<b_{1})+\E(b(X_{2})\cdot 1_{b(X_{2})>b_{1}})
\end{equation}
Прибавка в прибыли --- это ожидаемый платеж от второго игрока первому.

После чудо-замены:
\begin{equation}
\pi_{1}=(x-b(a))\P(X_{2}<a)+\E(b(X_{2})\cdot 1_{X_{2}>a})
\end{equation}

Запишем мат. ожидание в виде интеграла:
\begin{equation}
\pi_{1}=(x-b(a))F(a)+\int_{a}^{1}b(t)f(t)dt
\end{equation}

После взятия производной по $ a $:
\begin{equation}
-b'(a)F(a)+(x-b(a))f(a)-b(a)f(a)=0
\end{equation}

Требуем оптимальности стратегии  $ b_{1}=b(x) $:
\begin{equation}
-b'(x)F(x)+(x-b(x))f(x)-b(x)f(x)=0
\end{equation}

Для равномерного случая получаем:
\begin{equation}
-b'(x)x+x-b(x)-b(x)=0
\end{equation}

Находим общее решение и замечаем, что $ c=0 $ или сразу подбираем линейное решение $ b(x)=kx $:
\begin{equation}
-kx+x-2kx=0
\end{equation}

Получаем $ k=1/3 $ и равновесие Нэша вида $ b(x)=x/3 $.



\item 

Победа первого игрока, событие $ W_{1}=\{b(X_{2})<b_{1}\cap \ldots\cap b(X_{n})<b_{1}\} $. Чудо-замена  $ b_{1}=b(a) $ позволяет упростить его до $ W_{1}=\{X_{2}<a\cap\ldots\cap X_{n}<a\} $.

Функция прибыли:
\begin{equation}
\pi_{1}=\left(x-\E\left(\frac{b(X_{2})+\ldots+b(X_{n})}{n-1} \right|\left.\vphantom{\frac{b(X_{2})+\ldots+b(X_{n})}{n-1}} W_{1}\right)\right)\cdot \P(W_{1})
\end{equation}

В силу того, что $ X_{i} $ одинаково распределены и независимы, $ \P(W_{1})=F(a)^{n-1} $ и:
\begin{equation}
\pi_{1}=(x-\E\left(b(X_{2})|X_{2}<a)\right)\cdot F(a)^{n-1}
\end{equation}

Воспользуемся тем, что $ \E(b(X_{2})|X_{2}<a)\cdot \P(X_{2}<a)=\E(b(X_{2})\cdot 1_{X_{2}<a}) $:
\begin{equation}
\pi_{1}=x\cdot F(a)^{n-1}-\E\left(b(X_{2})\cdot 1_{X_{2}<a})\right)\cdot F(a)^{n-2}
\end{equation}

Заметим, что математическое ожидание равно интегралу: 
\begin{equation}
\E(b(X_{2})\cdot 1_{X_{2}<a})=\int_{0}^{a}b(t)f(t)dt
\end{equation}

Стало быть производная от мат. ожидания равна:

\begin{equation}
\frac{d \E(b(X_{2})\cdot 1_{X_{2}<a})}{d a}=b(a)f(a)
\end{equation}

Теперь легко находим производную прибыли:

\begin{multline}
\pi_{1}=F(a)^{n-1}+x\cdot (n-1) F(a)^{n-2}f(a)-\\
-\E\left(b(X_{2})\cdot 1_{X_{2}<a})\right)\cdot (n-2)F(a)^{n-3}f(a)-b(a)f(a)F(a)^{n-2}
\end{multline}

Приравняв к нулю и завершив чудо-замену замечанием, что $ a=x $ получаем уравнение:
\begin{equation}
(n-1)xF(x)f(x)-(n-2)\int_{0}^{x}b(t)f(t)dt f(x)-b(x)f(x)F(x)=0
\end{equation}

Вообще-то мы получили интегральное уравнение, т.е. уравнение с интегралами, а не с производными. Но его можно свести к дифференциальному, сделав замену $ y(x)=\int_{0}^{x}b(t)f(t)dt $, тогда $ b(x)f(x)=y'(x) $. В общем виде дальше мы его решать не будем, а вспомним, что у нас $ f(x)=1 $ и $ F(x)=x $:

\begin{equation}
(n-1)x^{2}-(n-2)\int_{0}^{x}b(t)dt -b(x)x=0
\end{equation}

Вместо возможной замены $ y(x)=\int_{0}^{x}b(t)dt $ мы возьмем производную от обеих частей уравнения:
\begin{equation}
(n-1)2x-(n-2)b(x)-b(x)-b'(x)x=0
\end{equation}

Неленивые могут найти общее решение и заметить, что нужно взять $ c=0 $. Ленивые сразу подбирают линейное решение $ b(x)=kx $:

\begin{equation}
(n-1)2x-(n-2)kx-kx-kx=0
\end{equation}

Получаем $ k=\frac{2(n-1)}{n} $ и равновесие Нэша со стратегиями вида $ b(x)=\frac{2(n-1)}{n}x $. Кстати, при $ n=2 $ мы получаем аукцион второй цены, а наше решение, как и следует, дает $ b(x)=x $.

Альтернативное решение по принципу <<Мне повезет и без дифуров>>:

А вдруг оптимальная стратегия линейна, т.е. имеет вид $ b(x)=kx $? Подставим эту функцию сразу в прибыль, до чудо-замены:

\begin{multline}
\pi_{1}=\left(x-\E\left(\frac{kX_{2}+\ldots+kX_{n}}{n-1}\right|\left.\vphantom{\frac{kX_{2}+\ldots+kX_{n}}{n-1}}kX_{2}<b_{1}\cap \ldots kX_{n}<b_{1}\right)\right)\cdot \\
\cdot \P(kX_{2}<b_{1}\cap \ldots kX_{n}<b_{1}))
\end{multline}

Упрощаем мат. ожидание и вероятность:

\begin{equation}
\pi_{1}=(x-k\E\left(X_{2}|X_{2}<b_{1}/k\right)\cdot \P(X_{2}<b_{1}/k\cap \ldots \cap X_{n}<b_{1}/k))
\end{equation}

Теперь условное мат. ожидание легко считается. Условие $ X_{2}<b_{1}/k $ и априорная равномерность $ X_{2} $ равносильны тому, что $ X_{2} $ равномерно на $ [0;b_{1}/k] $. Значит условное мат.ожидание равное $ \frac{b_{1}}{2k} $. Получаем:

\begin{equation}
\pi_{1}=\left( x-\frac{b_{1}}{2}\right)\cdot (b_{1}/k)^{n-1}
\end{equation}

Без чудо-замены берем производную по $ b_{1} $. Т.е. сразу ищем оптимальную ставку:

\begin{equation}
k^{1-n}\left( \left( x-\frac{b_{1}}{2} \right)\cdot (n-1)b_{1}^{n-2}-\frac{1}{2}b_{1}^{n-1} \right)=0
\end{equation}

Выражаем $ b_{1} $ и получаем $ b_{1}=\frac{2(n-1)}{n}x $. Поскольку она имеет предположенный вид, то все шаги были верными.


Считаем средний доход продавца. Поскольку все условия теоремы об одинаковой доходности выполнены, то ответ совпадает с найденным в лекции для аукциона первой цены: 
\begin{equation}
 \E(R^{MO})=\frac{n-1}{n+1}
\end{equation} 


\item 
Произвольная смешанная стратегия имеет вид:

Если $ X=0 $, то говорить <<да>> с вероятностью $ p_{0} $; если $ X=1 $, то говорить <<да>> с вероятностью $ p_{1} $. 

Пусть моя ценность равна 0. Если я скажу <<нет>>, то ничего не заплачу и возможно получу товар с нулевой для меня ценностью, значит мой ожидаемый выигрыш равен 0. Если я скажу <<да>>, то с положительной вероятностью мне придется платить $ a $, и мой ожидаемый выигрыш меньше 0. Значит, если ценность равна нулю, оптимально говорит  <<нет>>. Т.е. $ p_{0}=0 $.

Пусть моя ценность равна 1. Если я скажу <<нет>>, то получу в среднем:

\begin{equation}
(1-0.5p_{1})\cdot \frac{1}{2}
\end{equation}


Если я скажу <<да>>, то получу в среднем:

\begin{equation}
(1-0.5p_{1})\cdot (1-a)+0.5p_{1}\cdot \frac{1-a}{2}
\end{equation}

Чтобы смешанная стратегия была оптимальной, мне нужно быть безразличным между чистыми стратегиями, т.к. иначе я выбрал бы чистую. Приравниваем эти два выигрыша и находим $ p_{1} $.

Формально получается $ p_{1}=4-\frac{2}{a}$. Возникает несколько случаев\ldots

Если $ a\in (0;1/2) $, то равенство достигается только при $ p_{1}<0 $. Это означает, что при всех $ p_{1}\in [0;1] $ говорить <<да>> выгоднее, чем <<нет>>. Т.е. в равновесии каждый игрок использует стратегию: Если $ x=0 $, то <<нет>>, если $ x=1 $, то <<да>>

Если $ a\in (1/2;2/3) $, то равенство достигается только при $ p_{1}=4-\frac{2}{a} $. В равновесии каждый игрок использует стратегию: Если $ x=0 $, то <<нет>>, если $ x=1 $, то <<да>> с вероятностью $ p_{1}=4-\frac{2}{a}  $.

Если $ a=1/2 $, то при $ x=1 $ <<да>> лучше чем <<нет>> при $ p_{1}\in (0;1] $ и игрок безразличен между <<да>> и <<нет>> при $ p_{1}=0 $. Получаем равновесие с парой стратегий: Если $ x=0 $, то <<нет>>, если $ x=1 $, то <<да>>. И еще одно равновесий с парой стратегий: Всегда <<нет>>.

\end{enumerate}

